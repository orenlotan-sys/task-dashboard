<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ××©×™××•×ª - ××—×œ×§×ª ×”×œ×™×›×ª×™×•×ª ×•×¨×›×™×‘×”</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        body {
            font-family: 'Heebo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--gray-600);
            font-size: 1rem;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .sync-status.synced {
            background: #d1fae5;
            color: #065f46;
        }

        .sync-status.syncing {
            background: #fef3c7;
            color: #92400e;
        }

        .sync-status.error {
            background: #fee;
            color: #c00;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
            font-size: 0.875rem;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            font-family: 'Heebo', sans-serif;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .task-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            border-right: 4px solid var(--gray-300);
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .task-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .task-card.priority-P { border-right-color: var(--danger); }
        .task-card.priority-X { border-right-color: var(--primary); }
        .task-card.priority-O { border-right-color: var(--success); }
        .task-card.priority-V { border-right-color: var(--gray-400); }
        .task-card.priority-H { border-right-color: var(--warning); }
        .task-card.priority-D { border-right-color: var(--gray-500); }

        .task-header {
            margin-bottom: 1rem;
        }

        .task-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--gray-100);
            color: var(--gray-700);
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .task-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .task-owner {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .owner-badge {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .status-change-section {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
        }

        .status-change-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            display: block;
        }

        .status-select {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.375rem;
            font-family: 'Heebo', sans-serif;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .status-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-P { background: #fee; color: #c00; }
        .status-X { background: #e0f2fe; color: #0369a1; }
        .status-O { background: #d1fae5; color: #065f46; }
        .status-V { background: #f3f4f6; color: #374151; }
        .status-H { background: #fef3c7; color: #92400e; }
        .status-D { background: #f3f4f6; color: #6b7280; }

        .task-updates {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
        }

        .update-item {
            padding: 0.5rem 0.5rem 0.5rem 2rem;
            background: var(--gray-50);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            line-height: 1.5;
            position: relative;
        }

        .update-item.custom-update {
            background: #e0f2fe;
            border-right: 3px solid var(--primary);
        }

        .update-timestamp {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 0.25rem;
            display: block;
        }

        .delete-update-btn {
            position: absolute;
            left: 0.5rem;
            top: 0.75rem;
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .update-item:hover .delete-update-btn {
            opacity: 1;
        }

        .add-update-section {
            margin-top: 1rem;
        }

        .section-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .add-update-form {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .add-update-input,
        .add-todo-input {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.375rem;
            font-family: 'Heebo', sans-serif;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .add-update-input:focus,
        .add-todo-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .add-update-btn,
        .add-todo-btn {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.375rem;
            font-family: 'Heebo', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.875rem;
            white-space: nowrap;
        }

        .add-update-btn:hover,
        .add-todo-btn:hover {
            background: #1d4ed8;
        }

        .todo-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-200);
        }

        .todo-list {
            margin-bottom: 0.5rem;
        }

        .todo-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--gray-50);
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
        }

        .todo-checkbox {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .todo-text {
            flex: 1;
            font-size: 0.875rem;
            color: var(--gray-700);
            line-height: 1.5;
        }

        .todo-delete-btn {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
            flex-shrink: 0;
        }

        .todo-item:hover .todo-delete-btn {
            opacity: 1;
        }

        .toggle-updates {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
            font-family: 'Heebo', sans-serif;
        }

        .toggle-updates:hover {
            text-decoration: underline;
        }

        .updates-collapsed {
            display: none;
        }

        .action-buttons {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 1000;
        }

        .action-btn {
            padding: 1rem 1.5rem;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-family: 'Heebo', sans-serif;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.3);
        }

        .sync-btn {
            background: #4285f4;
        }

        .export-btn {
            background: var(--success);
        }

        .no-tasks {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            grid-column: 1/-1;
        }

        .no-tasks-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .no-tasks h3 {
            font-size: 1.5rem;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .no-tasks p {
            color: var(--gray-600);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š × ×™×”×•×œ ××©×™××•×ª - ××—×œ×§×ª ×”×œ×™×›×ª×™×•×ª ×•×¨×›×™×‘×”</h1>
            <p>××¢×¨×›×ª × ×™×”×•×œ ××©×™××•×ª ××™× ×˜×¨××§×˜×™×‘×™×ª ×¢× ×¡× ×›×¨×•×Ÿ Google Drive</p>
            <div class="sync-status" id="syncStatus">
                <span id="syncText">â³ ×˜×•×¢×Ÿ...</span>
            </div>
        </div>

        <div class="stats" id="stats"></div>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label>ğŸ” ×—×™×¤×•×©</label>
                    <input type="text" id="searchInput" placeholder="×—×¤×© ××©×™××•×ª...">
                </div>
                <div class="filter-group">
                    <label>ğŸ“‚ ×¡×•×’ ××©×™××”</label>
                    <select id="typeFilter">
                        <option value="">×”×›×œ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ğŸ‘¤ ××—×¨××™</label>
                    <select id="ownerFilter">
                        <option value="">×”×›×œ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>âš¡ ×¡×˜×˜×•×¡</label>
                    <select id="statusFilter">
                        <option value="">×”×›×œ</option>
                        <option value="P">P - ×§×“×™××•×ª ×’×‘×•×”×”</option>
                        <option value="X">X - ×‘×¢×‘×•×“×”</option>
                        <option value="O">O - ××ª××©×š</option>
                        <option value="V">V - ×”×•×©×œ×</option>
                        <option value="H">H - ×‘×”××ª× ×”</option>
                        <option value="D">D - ×‘×•×˜×œ</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="tasks-grid" id="tasksGrid"></div>

        <div class="action-buttons">
            <button class="action-btn sync-btn" id="syncBtn" onclick="manualSync()">
                â˜ï¸ ×¡× ×›×¨×Ÿ ×¢×›×©×™×•
            </button>
            <button class="action-btn export-btn" onclick="exportToJSON()">
                ğŸ’¾ ×™×™×¦× × ×ª×•× ×™×
            </button>
        </div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Google Drive Configuration
        const CLIENT_ID = '361503466250-ujofmlcf2jfu5ik0uorctgl09fsgm8h5.apps.googleusercontent.com';
        const API_KEY = 'YOUR_API_KEY_HERE'; // You'll need to create this in Google Cloud Console
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
        const STORAGE_KEY = 'tasksDashboardData';
        const DRIVE_FILE_NAME = 'task-dashboard-data.json';
        
        let gapiInited = false;
        let gisInited = false;
        let tokenClient;
        let driveFileId = null;

        const defaultTasks = [{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×”×§××ª ×¦×•×•×ª ×ª×›× ×•×Ÿ ×—× ×™×•×Ÿ × ×‘×•×Ÿ","owner":"××•×¨×Ÿ","status":"P","updates":["×”×•×¡×›× ×œ×”×¢×‘×™×¨ ×œ×¢×“×Ÿ","×”×•×—×œ×˜ ×œ×”×©××™×¨ ×‘×¦×ª×\"×œ","××—×›×” ×œ××™×©×•×¨ ×ª×§×¦×™×‘ ××ª\"×—","×××™×¨ ××ª×§×“×, ××—×›×™× ×œ××™×©×•×¨ ×—×•×–×”","××ª×§× ×™× × ×‘×“×§×•"]},{"type":"×¢×™×“×•×“ ×¨×›×™×‘×” ×•×”×œ×™×›×”","project":"×‘×™×ª ×¡×¤×¨ ×¨×•×›×‘","owner":"","status":"P","updates":["×—×•×–×” × ×©×œ×— ×œ××™×˜×œ ××œ××§×œ×¢×™","×™×© ×”×•×œ×“ ×¢×œ ×”×•×¢×“×ª ××›×¨×–×™×","×—×•×–×” ×ª×§×•×¢","× ×•×¨×™×ª ×”×¡×›×™××”, ×—×•×–×” ×ª×§×•×¢ ×‘×”×ª×§×©×¨×•×™×•×ª"]},{"type":"× ×™×”×•×œ ×›×œ×œ×™","project":"×œ×™×™×¦×¨ ××¦×’×ª ×œ×™×©×™ ×˜×œ××•×¨","owner":"","status":"P","updates":["××¦×’×ª ×¨××©×•× ×™×ª ××•×›× ×”"]},{"type":"× ×™×”×•×œ ×›×œ×œ×™","project":"×™×¦×™×¨×ª ×”×¦×’×” ×œ×¡×˜×™×‘ ×¢×œ ×¡×˜×˜×•×¡ ×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","owner":"","status":"P","updates":["××§×¡×œ ×§×™×™×"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×¡×˜× ×“×¨×˜ ×—× ×™×•× ×™× ×¢×™×¨×•× ×™","owner":"××•×¨×Ÿ","status":"X","updates":["×¤×’×™×©×” ×¨××©×•× ×” ×‘×•×¦×¢×”","×§×™×‘×œ× ×• ××ª ×”××¦×’×•×ª","×‘×™×§×©×ª×™ ××©×™×¨×Ÿ ×œ×§×‘×•×¢ ×¤×’×™×©×”","×¤×’×™×©×” ×‘×©× ×™ ×”×§×¨×•×‘","×‘×•×¦×¢×” ×”×¤×’×™×©×”","×ª×•×××” ×¤×’×™×©×” ×¢×œ ×‘×™×™×˜"]},{"type":"× ×™×”×•×œ ×›×œ×œ×™","project":"×œ×”×‘×™×Ÿ ××” ×”×¡×˜×˜×•×¡ ×©×œ ×”×©×‘×™×œ ×‘×“×•×“ ×”××œ×š","owner":"","status":"X","updates":["×”×ª×§×‘×œ"]},{"type":"× ×™×”×•×œ ××™×“×¢","project":"××¤×ª ××•×¤× ×™×™×","owner":"××•×¨×Ÿ","status":"X","updates":["×××ª×™×Ÿ ×œ×“× ×™××œ ×‘××™×™×‘","×”×•×¡×›× ×¢× ×“× ×™××œ ×œ×™×™×¦×¨ ××¤×ª ×¢×œ","× ×•×¦×¨×” ××¤×” ×¨××©×•× ×™×ª","×”×ª×§×‘×œ×• ×¡×¨×˜×•× ×™× ×××‘×™×‘"]},{"type":"×§×‘×•×¦×•×ª ×¨×›×™×©×” ×•×¡×‘×¡×•×“","project":"×§×‘×•×¦×ª ×¨×›×™×©×” ××¨×¦×™×ª","owner":"","status":"X","updates":["×©×™×—×” ×¢× ××™×ª×Ÿ ×¢×˜×™×”","×©×™×—×” ×‘×•×¦×¢×” ×¢× ×××™×” ×§×¨×‘×˜×¨×™","×’×™×•×¡ ××ª×§×“× ×©×œ ×¢×™×¨×™×•×ª","×§×•×œ ×§×•×¨× ×™×¦×, ××•×¡×¤×™× ××©×ª×ª×¤×™×"]},{"type":"×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™","project":"×”×¨ ×—×•××”","owner":"××•×¨×Ÿ","status":"X","updates":["×§×™×“×•× ×ª×•×›× ×™×ª ××‘","×”×•×ª× ×¢×” ×¢×‘×•×“×” ×¨××©×•× ×™×ª","×××ª×™×Ÿ ×¢×“ ×œ×¡×™×•× ×‘×•×¡×ª× ××™ ×•×©××¢×•× ×™"]},{"type":"×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™","project":"×ª×•×›× ×™×ª ××‘ ××¡×˜×¨×˜×’×™×ª","owner":"××•×¨×Ÿ","status":"X","updates":["×œ×™×•×•×™","×œ×™×•×•×™ ××ª××™×“"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×”×¨×¦×œ","owner":"××•×¨×Ÿ","status":"X","updates":["×§×™×“×•× ×œ×ª×›× ×•×Ÿ ××•×§×“×","××•×©×¨ ×‘×××™×¥","××—×›×” ×œ×ª×§×¦×•×‘ ×œ×ª×›× ×•×Ÿ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×¦×‘×™ ×™×”×•×“×”","owner":"××•×¨×Ÿ","status":"X","updates":["×§×™×“×•× ×œ×ª×›× ×•×Ÿ ××•×§×“×, × ×§×‘×¢×” ×¤×’×™×©×” ×‘×××™×¥","××•×©×¨ ×‘×××™×¥","××—×›×” ×œ×ª×§×¦×•×‘ ×œ×ª×›× ×•×Ÿ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×§×™× ×’ ×’'×•×¨×’'","owner":"××•×¨×Ÿ","status":"X","updates":["×§×™×“×•× ×œ×ª×›× ×•×Ÿ ××•×§×“×","× ×¢×¦×¨"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×–'×‘×•×˜×™× ×¡×§×™","owner":"××•×¨×Ÿ","status":"X","updates":["×¡×™×•× ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª","×œ×”×‘×™× ××™×©×•×¨ ×œ×¢×™×¨×™×™×”","×œ× ×ª×•×¢×“×£"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×’×™×œ×” ×˜×§×˜×™","owner":"××•×¨×Ÿ","status":"X","updates":["×”×©×œ××ª ××¢×’×œ×™ ×ª× ×•×¢×” ×‘×’×™×œ×”","×‘×¢×‘×•×“×” ××¦×œ ×¨×•×œ×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×‘×•×¡×ª× ××™","owner":"××•×¨×Ÿ","status":"X","updates":["×‘×‘×“×™×§×ª ×”×™×ª×›× ×•×ª ××¦×œ ××œ×™×” ×‘×Ÿ ×©×‘×ª","×”×•×¦×’ ×œ×¦×‘×™ ×•×’'×•×© ×•×œ×ª××™ ×•×¨××•×‘×Ÿ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×©××¢×•× ×™","owner":"××•×¨×Ÿ","status":"X","updates":["×‘×‘×“×™×§×ª ×”×™×ª×›× ×•×ª ××¦×œ ××œ×™×” ×‘×Ÿ ×©×‘×ª","×”×•×¦×’ ×œ×¦×‘×™ ×•×’'×•×© ×•×œ×ª××™ ×•×¨××•×‘×Ÿ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×”××¨\"×™","owner":"××•×¨×Ÿ","status":"X","updates":["×™×¦×™×¨×ª ×ª×›× ×•×Ÿ ×—×œ×•×¤×™","××—×›×” ×œ×¨×•×œ×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×©×‘×™×œ ×™×¤×•","owner":"××•×¨×Ÿ","status":"X","updates":["×œ×™×™×¦×¨ ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª ×¢×‘×•×¨ ×©×‘×™×œ ×™×¤×•","××™ ××¤×©×¨ ×œ×¢×©×•×ª ×—×•×–×”","×”×•×¢×‘×¨ ×—×•××¨ ×œ×“× ×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×¨×‘×§×”","owner":"××•×¨×Ÿ","status":"X","updates":["×‘×“×™×§×ª ×”×™×ª×›× ×•×ª"]},{"type":"×¢×™×“×•×“ ×¨×›×™×‘×” ×•×”×œ×™×›×”","project":"×¡×¤×¨×™×™×ª ××•×¤× ×™×™×","owner":"","status":"X","updates":["××¦×’×ª ×‘×¢×‘×•×“×”","××¦×’×ª ×”×¡×ª×™×™××”, × ×§×‘×¢×” ×¤×’×™×©×” ×¢× ×¢× ×¨","× ×¢×©×ª×” ×¤×’×™×©×” ×¢× ×¢× ×¨","×‘×•×¦×¢ ×¡×™×•×¨ ×‘×¡×¤×¨×™×™×”","××•×©×¨ ×‘×”×¨×œ\"×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×‘×™×ª ×”×—×™×™×œ","owner":"××•×¨×Ÿ","status":"X","updates":["×××ª×™×Ÿ ×œ×ª×§×¦×•×‘","×××ª×™×Ÿ ×œ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª ×©×œ ×©××•××œ","×¤×’×™×©×” × ×“×—×ª×”","×××ª×™×Ÿ ×œ×ª×›× ×•×Ÿ ××©××•××œ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×—×™×‘×•×¨ ×¤×¡×’\"×–","owner":"××•×¨×Ÿ","status":"X","updates":["×¡×™×•× ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"× ×•×£ ×¦×™×•×Ÿ","owner":"××•×¨×Ÿ","status":"X","updates":["×¡×™×•× ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª","××ª\"×— ×œ× ××™×©×¨"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×‘×™×ª ×¦×¤××¤×","owner":"××•×¨×Ÿ","status":"X","updates":["×œ× ×”×—×œ"]},{"type":"×¢×™×“×•×“ ×¨×›×™×‘×” ×•×”×œ×™×›×”","project":"×œ×™××•×“×™ ×¨×›×™×‘×” ×œ××‘×•×’×¨×™×","owner":"","status":"X","updates":["××•×¤× ×™×™× ×”×•×¢××“×•","× ×’××¨×• ×›×œ ×”×—×•×–×™× ×”×§×™×™××™×","× ×©×œ×—","×¢×‘×¨ ××ª ××™×™×œ×”"]},{"type":"×¨×’×•×œ×¦×™×”","project":"×§×™×“×•× ×¨×’×•×œ×¦×™×” ×œ×˜×•×‘×ª ××•×¤× ×™×™× ×”×™×‘×¨×™×“×™×™×","owner":"","status":"X","updates":["××—×›×” ×œ×™×©×™×‘×” ×‘××ª\"×—","××™×Ÿ ×™×©×™×‘×” ×¢× ××œ×™×”×•","×“×•×‘×¨ ×¢× ××™×™×œ","×”×•×¢×‘×¨ ×œ××™×™×œ"]},{"type":"×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™","project":"××–×¨×— ×”×¢×™×¨","owner":"××•×¨×Ÿ","status":"X","updates":["×”×ª× ×¢×ª ×ª×•×›× ×™×ª ××‘"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×§×¤×œ×Ÿ","owner":"××•×¨×Ÿ","status":"X","updates":["×œ×§×“× ×œ×‘×™×¦×•×¢","×××ª×™×Ÿ ×œ×”×—×œ×˜×” ×‘× ×•×’×¢ ×œ×ª×§×¦×•×‘","×××ª×™×Ÿ ×œ×™×©×™×‘×” ×¢× ×¨×•×¢×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×©××•××œ ×‘×¨×•×š","owner":"××•×¨×Ÿ","status":"O","updates":["××ª×§×“×","× ×¢×©×” ×¡×™×•×¨ ×©×˜×—","×‘×¢×‘×•×“×” ××¦×œ ×¨×•×œ×™"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"××¡×™×œ×•×ª - ×‘×™×ª ×”×›×¨×","owner":"××•×¨×Ÿ","status":"O","updates":["××™×©×•×¨ ××¡×™×œ×•×ª ×œ×¤×¨×•×™×™×§×˜ ×‘×™×ª ×”×›×¨×","×××ª×™× ×™× ×œ×ª×©×•×‘×” ××‘×¨×§ ×›×¨××“×™"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×”×¨×—×‘×” ×œ×ª×—× ×” ××¨×›×–×™×ª","owner":"××•×¨×Ÿ","status":"O","updates":["×œ× ×”×ª×—×™×œ"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×—× ×™×•×Ÿ ××•×¤× ×™×™× ×¨×›×‘×ª ××¨×›×–","owner":"××•×¨×Ÿ","status":"O","updates":["×‘×ª×›× ×•×Ÿ","×××ª×™×Ÿ ×œ×“× ×” ×‘×•×¨×©×˜×™×™×Ÿ ×©×ª×—×–×™×¨ ×ª×©×•×‘×•×ª"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×—× ×™×•×Ÿ ××•×¤× ×™×™× ×—××Ÿ","owner":"××•×¨×Ÿ","status":"O","updates":["×‘×ª×›× ×•×Ÿ"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"××¡×™×œ×•×ª - ×× ×”×¤×™× ×§×˜× ×™×","owner":"××•×¨×Ÿ","status":"O","updates":["×××ª×™×Ÿ ×œ×—×•×–×” ×× ×”\"×¤×™× ×§×˜× ×™×","××—×›×” ×œ×¡×™×•×¢ ××¦×‘×™"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"××¡×™×œ×•×ª - ×¨×©×™××ª ×‘×™×¦×•×¢","owner":"××•×¨×Ÿ","status":"O","updates":["×™×¦×™×¨×ª ×¨×©×™××ª ××¡×™×œ×•×ª ×œ×‘×™×¦×•×¢","×××ª×™×Ÿ ×œ×”×œ×‘× ×”4"]},{"type":"×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™","project":"×¤×¨×•×™×™×§×˜×•×¨ ×‘×™×ª ×”×›×¨×","owner":"××•×¨×Ÿ","status":"O","updates":["××ª×§×“×"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×“×¨×š ×—×‘×¨×•×Ÿ","owner":"××•×¨×Ÿ","status":"O","updates":["×œ×œ×•×•×ª ×™×©×™×‘×•×ª ××¦×œ ×¦×‘×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×¦×™×¨ ×™×¨×•×§","owner":"××•×¨×Ÿ","status":"O","updates":["×œ×™×•×•×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×¨×—×‘×™×” ×‘ - ×”×¦×’×”","owner":"××•×¨×Ÿ","status":"O","updates":["×œ×™×•×•×™, ×”×¦×’×” ×œ××™× ×”×œ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×¨×—×‘×™×” ×‘ - ×œ×™×•×•×™","owner":"××•×¨×Ÿ","status":"O","updates":["×œ×™×•×•×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×”× ×©×™× ×”×©×™×©×™","owner":"××•×¨×Ÿ","status":"O","updates":["×œ×™×•×•×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×”×¨ ×—×•××” - ×–×¨×— ×•×¨×”×¤×˜×™×’","owner":"××•×¨×Ÿ","status":"O","updates":["×œ×§×“× ××ª ×–×¨×— ×•×¨×”×¤×˜×™×’","×‘×¢×‘×•×“×”","×—×–×¨ ×œ×”×ª×§×“×"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"××”×¨×•× ×•×‘","owner":"××•×¨×Ÿ","status":"O","updates":["×”×ª× ×¢×ª ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª","×”×•×¢×‘×¨ ×œ×“× ×™","×”×ª×—×™×œ×” ×‘×“×™×§×ª ×”×™×ª×›× ×•×ª","×—×–×¨ ×œ×¢×‘×•×“×”, ××ª×§×“×"]},{"type":"×§×‘×•×¦×•×ª ×¨×›×™×©×” ×•×¡×‘×¡×•×“","project":"×œ×™×¡×™× ×’ ××•×¤× ×™×™× ×”×™×‘×¨×™×“×™×™×","owner":"","status":"H","updates":["×œ× ×”×—×œ","××‘×™ ×¢×™×“×›×Ÿ ×©×”×•× ×œ× ×™×˜×¤×œ","××‘×™ ×™×¢×“×›×Ÿ ×‘×ª×—×™×œ×ª ×“×¦××‘×¨","×‘×”××ª× ×”"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×—× ×™×•×ª ×¨×—×•×‘×™×•×ª ××•×’× ×•×ª - ×”×ª× ×¢×”","owner":"××•×¨×Ÿ","status":"H","updates":["×œ× ×”×—×œ","××—×›×” ×œ×ª×§×¦×•×‘ ×××ª\"×—","×¢×‘×¨ ×œ×”×•×œ×“"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×—× ×™×•×ª ×¨×—×•×‘×™×•×ª ××•×’× ×•×ª - ××™×¤×™×•×Ÿ","owner":"××•×¨×Ÿ","status":"H","updates":["×œ× ×”×—×œ","×××ª×™×Ÿ ×œ×”×—×œ×˜×” ×‘× ×•×’×¢ ×œ×ª×§×¦×•×‘"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×—× ×™×•×ª ××•×¤× ×™×™× ×¨×—×•×‘×™×•×ª - ×¤×¨×™×¡×”","owner":"××•×¨×Ÿ","status":"H","updates":["×××ª×™×Ÿ ×œ×ª×§×¦×•×‘"]},{"type":"×—× ×™×•× ×™×, ×—× ×™×•×ª, ××¡×™×œ×•×ª","project":"×—× ×™×•×ª ××•×¤× ×™×™× ×¨×’×™×œ×•×ª - ××™×¤×™×•×Ÿ","owner":"××•×¨×Ÿ","status":"H","updates":["×§×™×™× ×©××œ×•×Ÿ ××•×›×Ÿ ×œ×”×¤×¦×”"]},{"type":"×›× ×¡×™ ××•×¤× ×™×™×","project":"×›× ×¡ ××•×¤× ×™×™× ×¢×™×¨×•× ×™","owner":"","status":"H","updates":["×œ× ×”×—×œ","×™×© ×©×™×— ×¨××©×•× ×™ ×¢× ×œ×‘× ×“×™×’×¨"]},{"type":"×¢×™×“×•×“ ×¨×›×™×‘×” ×•×”×œ×™×›×”","project":"×™×¦×™×¨×ª ×¡×¨×˜×•×Ÿ ×ª×“××™×ª","owner":"","status":"H","updates":["××—×›×” ×œ×¡×¨×˜×•× ×™× ×××‘×™×‘ × ×—×©×•×Ÿ","×”×ª×§×‘×œ×• ×¡×¨×˜×•× ×™× ×××‘×™×‘"]},{"type":"×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™","project":"×™×¦×™×¨×ª ×ª×•×›× ×™×ª × ×’×“ ×’× ×™×‘×•×ª","owner":"","status":"H","updates":["×§×™×™××ª ×˜×™×•×˜× ×¨××©×•× ×”","×™××ª×™×Ÿ ×œ×ª×—×™×œ×ª ×”×ª×¤×§×™×“"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×¢×•×§×£ ×× ×”×¨×”","owner":"××•×¨×Ÿ","status":"H","updates":["×œ× ×”×—×œ"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×›×•×‘×©×™ ×§×˜××•×Ÿ","owner":"××•×¨×Ÿ","status":"H","updates":["×œ×™×•×•×™","×›×¨×’×¢ ××§×“××™× ××ª ×‘×•×¡×ª× ××™ ×‘××§×•×"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"××’×¨×•×Ÿ - ×¨××‘×Ÿ","owner":"××•×¨×Ÿ","status":"H","updates":["×‘×“×™×§×ª ×”×™×ª×›× ×•×ª","×‘×”×•×œ×“ ×¢×“ ×¡×™×•× ×‘×™×ª ×”×—×™×™×œ"]},{"type":"×¢×™×“×•×“ ×¨×›×™×‘×” ×•×”×œ×™×›×”","project":"×¤×’×™×©×” ×¢× ×××™×¥","owner":"","status":"V","updates":["×××ª×™×Ÿ ×œ×¤×’×™×©×”","× ×©×œ×— ×œ×× ×” ××¡××š ×”×¡×‘×¨ ×œ×—×©×‘×•×ª"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"× ×ª×™×‘×™ ××˜×¨","owner":"××•×¨×Ÿ","status":"V","updates":["×§×™×“×•× ×ª×›× ×•×Ÿ ×œ×ª×œ ×—×™-×‘×•×¡×˜× ××™","××•×©×¨ ×œ×”×‘×™× × ×ª×™×‘×™× × ×™×¡×™×•× ×™×™×","× ×§×‘×¢ ×¡×™×•×¨ ×©×˜×—"]},{"type":"×›× ×¡×™ ××•×¤× ×™×™×","project":"×”×¨×¦××” ×‘×•×œ×•×¡×™×˜×™","owner":"","status":"V","updates":["×”×•×’×© ××‘×¡×˜×¨×§×˜ ×¨××©×•× ×™"]},{"type":"××•×¤× ×™×™× ×©×™×ª×•×¤×™×™×","project":"×§×™×©×•×¨ ×™×¨×•×¤××Ÿ ×œ×ª×—×‘×¦","owner":"××•×¨×Ÿ","status":"V","updates":["××™×¤×™×•×Ÿ ××¦×œ ×¨×•×‘×¨×˜ ××¡×—×§","××™×¤×™×•×Ÿ ×”×¡×ª×™×™×, ×”×•×¢×‘×¨ ×œ× ×•×¢×”"]},{"type":"××•×¤× ×™×™× ×©×™×ª×•×¤×™×™×","project":"×§×•×¨×§×™× ×˜×™×","owner":"××•×¨×Ÿ","status":"V","updates":["× ×¢×©×” ×¡×™×•×¨ ×•×˜×™×•×‘ ×©×œ ××§×•××•×ª ×œ×¤×•×œ×™×’×•× ×™×"]},{"type":"×”×¡×‘×¨×”, ×©×™×ª×•×¤×™ ×¦×™×‘×•×¨","project":"××¤×ª ××•×¤× ×™×™× - ×’×•×’×œ","owner":"××•×¨×Ÿ","status":"V","updates":["×’×•×’×œ ××¤×•×ª"]},{"type":"×”×¡×‘×¨×”, ×©×™×ª×•×¤×™ ×¦×™×‘×•×¨","project":"×©×™×ª×•×£ ×¦×™×‘×•×¨ ×’×™×œ×”","owner":"××•×¨×Ÿ","status":"V","updates":["× ×§×‘×¢ ×ª××¨×™×š","×”×¡×ª×™×™× ×‘×”×¦×œ×—×”"]},{"type":"× ×™×”×•×œ ×›×œ×œ×™","project":"×¡×™×•×¨ ×¢×‘×•×¨ ×ª××™×¨","owner":"","status":"V","updates":["×™×¨×•×¤××Ÿ ×™×•×“×¢×•","×™×© ×›×œ×™×"]},{"type":"× ×™×”×•×œ ×›×œ×œ×™","project":"×œ×’×©×ª ×œ××›×¨×–","owner":"","status":"V","updates":["×œ×’×©×ª ×œ××›×¨×– ×× ×”×œ ××—×œ×§×”","××›×¨×– ×”×•×’×©"]},{"type":"× ×™×”×•×œ ×›×œ×œ×™","project":"×”×›× ×ª ××¦×’×ª ×œ×¨××© ×”×¢×™×¨","owner":"","status":"V","updates":[]},{"type":"×§×‘×•×¦×•×ª ×¨×›×™×©×” ×•×¡×‘×¡×•×“","project":"×—×•×–×” ×§××¤×™×™× ×¨","owner":"","status":"V","updates":["×œ× ×”×ª×—×™×œ","× ×‘×—×¨×” ××™×¨×‘ ×“×“×©","×—×•×–×” ×ª×§×•×¢ ×‘×”×ª×§×©×¨×•×™×•×ª","×¡×‘×‘ ×—×ª×™××•×ª ×”×¡×ª×™×™×"]},{"type":"×ª×›× ×•×Ÿ ××¡×˜×¨×˜×’×™","project":"×”×¦×’×ª ×ª×™×¢×“×•×£ ×œ×××™×¥","owner":"××•×¨×Ÿ","status":"V","updates":["××—×›×” ×œ×™×©×™×‘×”","×”×•×¦×’ ×ª×™×¢×“×•×£"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"××‘×™×–×•×”×¨","owner":"××•×¨×Ÿ","status":"V","updates":["××§×•×“×","×‘×¢×‘×•×“×”"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×œ×•×¨×š","owner":"××•×¨×Ÿ","status":"V","updates":["×”×ª×§×‘×œ×• ×ª×•×›× ×™×•×ª ××¦×‘ ×¡×•×¤×™","××” ×©×§×™×™×, ×§×™×™×"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×‘×¨ ×œ×‘","owner":"××•×¨×Ÿ","status":"V","updates":["×œ×™×•×•×™","×¢×œ×” ×œ×•×¢×“×ª ×”×™×’×•×™"]},{"type":"×ª×›× ×•×Ÿ ×©×‘×™×œ×™× ×•×‘×“×™×§×•×ª ×”×™×ª×›× ×•×ª","project":"×“×•×¡×˜×¨×•×‘×¡×§×™","owner":"××•×¨×Ÿ","status":"D","updates":["×œ×‘×˜×œ ×™××™× ×” ×—×•×¤×©×™"]}];

        let tasks = [];
        let filteredTasks = [];

        // Initialize Google APIs
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            try {
                await gapi.client.init({
                    discoveryDocs: DISCOVERY_DOCS,
                });
                gapiInited = true;
                maybeEnableButtons();
            } catch (error) {
                console.error('Error initializing GAPI client:', error);
                updateSyncStatus('error', '×©×’×™××” ×‘××ª×—×•×œ Google Drive');
            }
        }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '',
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                loadTasks();
            }
        }

        function updateSyncStatus(status, message) {
            const statusEl = document.getElementById('syncStatus');
            const textEl = document.getElementById('syncText');
            
            statusEl.className = 'sync-status';
            
            if (status === 'synced') {
                statusEl.classList.add('synced');
                textEl.textContent = `âœ“ ${message}`;
            } else if (status === 'syncing') {
                statusEl.classList.add('syncing');
                textEl.textContent = `â³ ${message}`;
            } else if (status === 'error') {
                statusEl.classList.add('error');
                textEl.textContent = `âŒ ${message}`;
            } else {
                textEl.textContent = message;
            }
        }

        function loadTasks() {
            // Try to load from localStorage first
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    const parsed = JSON.parse(stored);
                    tasks = parsed.map(task => ({
                        ...task,
                        customUpdates: task.customUpdates || [],
                        todos: task.todos || [],
                        updates: task.updates || []
                    }));
                    updateSyncStatus('synced', '× ×˜×¢×Ÿ ×××—×¡×•×Ÿ ××§×•××™');
                } catch (e) {
                    console.error('Error loading tasks:', e);
                    tasks = defaultTasks;
                    updateSyncStatus('synced', '× ×˜×¢×Ÿ ×× ×ª×•× ×™× ×‘×¨×™×¨×ª ××—×“×œ');
                }
            } else {
                tasks = defaultTasks;
                updateSyncStatus('synced', '× ×˜×¢×Ÿ ×× ×ª×•× ×™× ×‘×¨×™×¨×ª ××—×“×œ');
            }
            
            filteredTasks = [...tasks];
            renderStats();
            populateFilters();
            renderTasks();
            
            // Try to sync with Google Drive after initial load
            setTimeout(syncFromDrive, 1000);
        }

        function saveTasks() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
        }

        async function syncFromDrive() {
            if (!gapiInited || !gisInited) {
                updateSyncStatus('error', 'Google Drive ×œ× ×××•×ª×—×œ');
                return;
            }

            try {
                updateSyncStatus('syncing', '××¡× ×›×¨×Ÿ ×¢× Google Drive...');
                
                // Request access token
                tokenClient.callback = async (resp) => {
                    if (resp.error !== undefined) {
                        updateSyncStatus('error', '×©×’×™××” ×‘××™××•×ª');
                        return;
                    }
                    
                    await performSync();
                };

                if (gapi.client.getToken() === null) {
                    tokenClient.requestAccessToken({prompt: 'consent'});
                } else {
                    tokenClient.requestAccessToken({prompt: ''});
                }
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('error', '×©×’×™××” ×‘×¡× ×›×¨×•×Ÿ');
            }
        }

        async function performSync() {
            try {
                // Search for existing file
                const response = await gapi.client.drive.files.list({
                    q: `name='${DRIVE_FILE_NAME}' and trashed=false`,
                    spaces: 'drive',
                    fields: 'files(id, name, modifiedTime)',
                });

                const files = response.result.files;
                
                if (files && files.length > 0) {
                    // File exists, download it
                    driveFileId = files[0].id;
                    const fileResponse = await gapi.client.drive.files.get({
                        fileId: driveFileId,
                        alt: 'media',
                    });
                    
                    const driveData = JSON.parse(fileResponse.body);
                    
                    // Merge with local data (use latest)
                    tasks = driveData.map(task => ({
                        ...task,
                        customUpdates: task.customUpdates || [],
                        todos: task.todos || [],
                        updates: task.updates || []
                    }));
                    
                    saveTasks();
                    filteredTasks = [...tasks];
                    renderStats();
                    renderTasks();
                    
                    updateSyncStatus('synced', `×¡×•× ×›×¨×Ÿ ×-Google Drive (${new Date(files[0].modifiedTime).toLocaleString('he-IL')})`);
                } else {
                    // File doesn't exist, create it
                    await uploadToDrive();
                }
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('error', '×©×’×™××” ×‘×§×¨×™××ª × ×ª×•× ×™× ×-Google Drive');
            }
        }

        async function uploadToDrive() {
            try {
                updateSyncStatus('syncing', '×©×•××¨ ×œ-Google Drive...');
                
                const fileContent = JSON.stringify(tasks, null, 2);
                const file = new Blob([fileContent], {type: 'application/json'});
                
                const metadata = {
                    name: DRIVE_FILE_NAME,
                    mimeType: 'application/json',
                };

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
                form.append('file', file);

                let response;
                if (driveFileId) {
                    // Update existing file
                    response = await fetch(`https://www.googleapis.com/upload/drive/v3/files/${driveFileId}?uploadType=multipart`, {
                        method: 'PATCH',
                        headers: new Headers({'Authorization': 'Bearer ' + gapi.client.getToken().access_token}),
                        body: form,
                    });
                } else {
                    // Create new file
                    response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                        method: 'POST',
                        headers: new Headers({'Authorization': 'Bearer ' + gapi.client.getToken().access_token}),
                        body: form,
                    });
                }

                const result = await response.json();
                driveFileId = result.id;
                
                updateSyncStatus('synced', `× ×©××¨ ×‘-Google Drive (${new Date().toLocaleString('he-IL')})`);
            } catch (error) {
                console.error('Upload error:', error);
                updateSyncStatus('error', '×©×’×™××” ×‘×©××™×¨×” ×œ-Google Drive');
            }
        }

        window.manualSync = async function() {
            await syncFromDrive();
        };

        function getTaskIndex(project, type) {
            return tasks.findIndex(t => t.project === project && t.type === type);
        }

        function updateTaskStatus(project, type, newStatus) {
            const index = getTaskIndex(project, type);
            if (index !== -1) {
                tasks[index].status = newStatus;
                saveTasks();
                uploadToDrive();
                applyFilters();
                renderStats();
            }
        }

        function addUpdate(project, type, updateText) {
            const index = getTaskIndex(project, type);
            if (index !== -1) {
                if (!tasks[index].customUpdates) {
                    tasks[index].customUpdates = [];
                }
                tasks[index].customUpdates.push({
                    text: updateText,
                    timestamp: new Date().toISOString()
                });
                saveTasks();
                uploadToDrive();
                applyFilters();
            }
        }

        function deleteUpdate(project, type, updateIndex) {
            const index = getTaskIndex(project, type);
            if (index !== -1 && tasks[index].customUpdates) {
                tasks[index].customUpdates.splice(updateIndex, 1);
                saveTasks();
                uploadToDrive();
                applyFilters();
            }
        }

        function addTodo(project, type, todoText) {
            const index = getTaskIndex(project, type);
            if (index !== -1) {
                if (!tasks[index].todos) {
                    tasks[index].todos = [];
                }
                tasks[index].todos.push({
                    text: todoText,
                    completed: false,
                    timestamp: new Date().toISOString()
                });
                saveTasks();
                uploadToDrive();
                applyFilters();
            }
        }

        function toggleTodo(project, type, todoIndex) {
            const index = getTaskIndex(project, type);
            if (index !== -1 && tasks[index].todos && tasks[index].todos[todoIndex]) {
                tasks[index].todos[todoIndex].completed = !tasks[index].todos[todoIndex].completed;
                saveTasks();
                uploadToDrive();
                applyFilters();
            }
        }

        function deleteTodo(project, type, todoIndex) {
            const index = getTaskIndex(project, type);
            if (index !== -1 && tasks[index].todos) {
                tasks[index].todos.splice(todoIndex, 1);
                saveTasks();
                uploadToDrive();
                applyFilters();
            }
        }

        function getStatusLabel(status) {
            const labels = {
                'P': '×§×“×™××•×ª ×’×‘×•×”×”',
                'X': '×‘×¢×‘×•×“×”',
                'O': '××ª××©×š',
                'V': '×”×•×©×œ×',
                'H': '×‘×”××ª× ×”',
                'D': '×‘×•×˜×œ'
            };
            return labels[status] || status;
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            // For very recent items, show relative time
            if (diffMins < 1) return '×¢×›×©×™×•';
            if (diffMins < 60) return `×œ×¤× ×™ ${diffMins} ×“×§×•×ª`;
            if (diffHours < 24) return `×œ×¤× ×™ ${diffHours} ×©×¢×•×ª`;
            
            // For items within a week, show "X days ago"
            if (diffDays < 7) return `×œ×¤× ×™ ${diffDays} ×™××™×`;
            
            // For older items, show the actual date
            const dateStr = date.toLocaleDateString('he-IL', { 
                day: 'numeric', 
                month: 'short', 
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
            
            const timeStr = date.toLocaleTimeString('he-IL', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            return `${dateStr} ×‘×©×¢×” ${timeStr}`;
        }

        function renderStats() {
            const stats = {
                total: tasks.length,
                priority: tasks.filter(t => t.status === 'P').length,
                inProgress: tasks.filter(t => t.status === 'X').length,
                completed: tasks.filter(t => t.status === 'V').length,
                ongoing: tasks.filter(t => t.status === 'O').length,
                onHold: tasks.filter(t => t.status === 'H').length
            };

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--gray-800);">${stats.total}</div>
                    <div class="stat-label">×¡×”"×› ××©×™××•×ª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--danger);">${stats.priority}</div>
                    <div class="stat-label">×§×“×™××•×ª ×’×‘×•×”×”</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--primary);">${stats.inProgress}</div>
                    <div class="stat-label">×‘×¢×‘×•×“×”</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--success);">${stats.ongoing}</div>
                    <div class="stat-label">××ª××©×š</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--warning);">${stats.onHold}</div>
                    <div class="stat-label">×‘×”××ª× ×”</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--gray-500);">${stats.completed}</div>
                    <div class="stat-label">×”×•×©×œ×</div>
                </div>
            `;
        }

        function populateFilters() {
            const types = [...new Set(tasks.map(t => t.type))].filter(Boolean).sort();
            const owners = [...new Set(tasks.map(t => t.owner))].filter(o => o && o !== 'nan' && o !== '').sort();

            document.getElementById('typeFilter').innerHTML = '<option value="">×”×›×œ</option>' +
                types.map(type => `<option value="${type}">${type}</option>`).join('');

            document.getElementById('ownerFilter').innerHTML = '<option value="">×”×›×œ</option>' +
                owners.map(owner => `<option value="${owner}">${owner}</option>`).join('');
        }

        function renderTasks() {
            const grid = document.getElementById('tasksGrid');
            
            if (filteredTasks.length === 0) {
                grid.innerHTML = `
                    <div class="no-tasks">
                        <div class="no-tasks-icon">ğŸ”</div>
                        <h3>×œ× × ××¦××• ××©×™××•×ª</h3>
                        <p>× ×¡×” ×œ×©× ×•×ª ××ª ×”×¡×™× ×•×Ÿ ××• ×”×—×™×¤×•×©</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredTasks.map((task, index) => {
                const ownerInitial = task.owner && task.owner !== 'nan' && task.owner !== '' ? task.owner.charAt(0) : '?';
                const hasOriginalUpdates = task.updates && task.updates.length > 0;
                const hasCustomUpdates = task.customUpdates && task.customUpdates.length > 0;
                const hasTodos = task.todos && task.todos.length > 0;
                const updateId = `updates-${task.project.replace(/\s/g, '-')}-${index}`;
                
                const allUpdates = [
                    ...(task.updates || []).map(u => ({ text: u, isCustom: false })),
                    ...(task.customUpdates || []).map(u => ({ ...u, isCustom: true }))
                ];
                
                return `
                    <div class="task-card priority-${task.status}" style="animation-delay: ${index * 0.05}s;">
                        <div class="task-header">
                            <div class="task-type">${task.type}</div>
                            <div class="task-title">${task.project}</div>
                            ${task.owner && task.owner !== 'nan' && task.owner !== '' ? `
                                <div class="task-owner">
                                    <div class="owner-badge">${ownerInitial}</div>
                                    <span>${task.owner}</span>
                                </div>
                            ` : ''}
                        </div>

                        <div class="status-change-section">
                            <label class="status-change-label">×©× ×” ×¡×˜×˜×•×¡:</label>
                            <select class="status-select" onchange="updateTaskStatus('${task.project}', '${task.type}', this.value)">
                                <option value="P" ${task.status === 'P' ? 'selected' : ''}>P - ×§×“×™××•×ª ×’×‘×•×”×”</option>
                                <option value="X" ${task.status === 'X' ? 'selected' : ''}>X - ×‘×¢×‘×•×“×”</option>
                                <option value="O" ${task.status === 'O' ? 'selected' : ''}>O - ××ª××©×š</option>
                                <option value="V" ${task.status === 'V' ? 'selected' : ''}>V - ×”×•×©×œ×</option>
                                <option value="H" ${task.status === 'H' ? 'selected' : ''}>H - ×‘×”××ª× ×”</option>
                                <option value="D" ${task.status === 'D' ? 'selected' : ''}>D - ×‘×•×˜×œ</option>
                            </select>
                        </div>

                        ${allUpdates.length > 0 ? `
                            <button class="toggle-updates" onclick="toggleUpdates('${updateId}')">
                                ğŸ“‹ ×”×¦×’ ×¢×“×›×•× ×™× (${allUpdates.length})
                            </button>
                            <div class="task-updates updates-collapsed" id="${updateId}">
                                ${allUpdates.map((update, idx) => {
                                    if (update.isCustom) {
                                        const customIdx = (task.customUpdates || []).findIndex(u => u.text === update.text && u.timestamp === update.timestamp);
                                        return `
                                            <div class="update-item custom-update">
                                                <button class="delete-update-btn" onclick="deleteUpdate('${task.project}', '${task.type}', ${customIdx})" title="××—×§ ×¢×“×›×•×Ÿ">ğŸ—‘ï¸</button>
                                                <div>${update.text}</div>
                                                <span class="update-timestamp">ğŸ“… ${formatDate(update.timestamp)}</span>
                                            </div>
                                        `;
                                    } else {
                                        return `<div class="update-item">${update.text}</div>`;
                                    }
                                }).join('')}
                            </div>
                        ` : ''}

                        <div class="add-update-section">
                            <div class="section-title">â• ×”×•×¡×£ ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡</div>
                            <div class="add-update-form">
                                <input 
                                    type="text" 
                                    class="add-update-input" 
                                    id="update-input-${index}"
                                    placeholder="×”×–×Ÿ ×¢×“×›×•×Ÿ ×—×“×©..."
                                    onkeypress="if(event.key==='Enter') addUpdateFromInput('${task.project}', '${task.type}', ${index})"
                                >
                                <button class="add-update-btn" onclick="addUpdateFromInput('${task.project}', '${task.type}', ${index})">
                                    ×”×•×¡×£
                                </button>
                            </div>
                        </div>

                        <div class="todo-section">
                            <div class="section-title">âœ“ ××©×™××•×ª ×œ×‘×™×¦×•×¢</div>
                            ${hasTodos ? `
                                <div class="todo-list">
                                    ${task.todos.map((todo, todoIdx) => `
                                        <div class="todo-item ${todo.completed ? 'completed' : ''}">
                                            <input 
                                                type="checkbox" 
                                                class="todo-checkbox" 
                                                ${todo.completed ? 'checked' : ''}
                                                onchange="toggleTodo('${task.project}', '${task.type}', ${todoIdx})"
                                            >
                                            <div style="flex: 1;">
                                                <span class="todo-text">${todo.text}</span>
                                                <div class="update-timestamp">ğŸ“… × ×•×¦×¨ ${formatDate(todo.timestamp)}</div>
                                            </div>
                                            <button class="todo-delete-btn" onclick="deleteTodo('${task.project}', '${task.type}', ${todoIdx})">ğŸ—‘ï¸</button>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            <div class="add-update-form">
                                <input 
                                    type="text" 
                                    class="add-todo-input" 
                                    id="todo-input-${index}"
                                    placeholder="×”×–×Ÿ ××©×™××” ×—×“×©×”..."
                                    onkeypress="if(event.key==='Enter') addTodoFromInput('${task.project}', '${task.type}', ${index})"
                                >
                                <button class="add-todo-btn" onclick="addTodoFromInput('${task.project}', '${task.type}', ${index})">
                                    ×”×•×¡×£
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.toggleUpdates = function(id) {
            const element = document.getElementById(id);
            element.classList.toggle('updates-collapsed');
        };

        window.addUpdateFromInput = function(project, type, index) {
            const input = document.getElementById(`update-input-${index}`);
            const text = input.value.trim();
            if (text) {
                addUpdate(project, type, text);
                input.value = '';
            }
        };

        window.addTodoFromInput = function(project, type, index) {
            const input = document.getElementById(`todo-input-${index}`);
            const text = input.value.trim();
            if (text) {
                addTodo(project, type, text);
                input.value = '';
            }
        };

        window.exportToJSON = function() {
            const dataStr = JSON.stringify(tasks, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `tasks-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        };

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const ownerFilter = document.getElementById('ownerFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredTasks = tasks.filter(task => {
                const matchesSearch = !search || 
                    task.project.toLowerCase().includes(search) ||
                    task.type.toLowerCase().includes(search) ||
                    (task.updates && task.updates.some(u => u.toLowerCase().includes(search))) ||
                    (task.customUpdates && task.customUpdates.some(u => u.text.toLowerCase().includes(search))) ||
                    (task.todos && task.todos.some(t => t.text.toLowerCase().includes(search)));
                
                const matchesType = !typeFilter || task.type === typeFilter;
                const matchesOwner = !ownerFilter || task.owner === ownerFilter;
                const matchesStatus = !statusFilter || task.status === statusFilter;

                return matchesSearch && matchesType && matchesOwner && matchesStatus;
            });

            renderTasks();
        }

        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('typeFilter').addEventListener('change', applyFilters);
        document.getElementById('ownerFilter').addEventListener('change', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);

        // Load Google APIs
        window.gapiLoaded = gapiLoaded;
        window.gisLoaded = gisLoaded;
    </script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
</body>
</html>
